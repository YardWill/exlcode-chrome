function trackEvent(action) {
    if (chrome.extension) {
        chrome.extension.sendMessage({
            reqType: "track",
            category: "inject-github",
            action: action
        }, function (response) {});
    }
}

var desktopBtn = $('<a id="exlcode-btn" target="_blank" class="btn btn-sm exlcode-primary-btn"><svg version="1.1" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="#fff" fill-rule="nonzero"><g transform="translate(0 6)"><path d="m368 105.2c-0.48159 4.3413-0.24079 9.4062-0.48159 13.748-0.48158 12.3-1.204 24.119-2.1671 35.695-1.204 15.918-2.8895 31.113-4.5751 46.549-1.6855 12.783-3.3711 25.566-5.5382 38.107-1.204 7.4767-2.6487 14.712-3.8527 21.948-4.3343 23.877-10.113 47.272-16.855 70.426-4.8159 16.159-10.113 31.595-16.374 46.549-12.28 29.666-26.728 56.92-45.991 80.315-9.3909 11.818-20.467 21.948-33.229 29.907-14.929 9.4062-32.989 13.265-50.566 10.853-33.952-5.5473-52.734-34.007-58.994-67.291-7.2238-37.625 0-80.074 7.9462-112.63 3.8527-16.401 8.6685-32.078 14.207-47.272 8.4277-22.913 17.578-44.86 27.691-66.085 3.1303-6.512 6.5014-13.265 9.6317-20.018 6.2606-12.059 12.521-24.119 19.263-35.937 7.7054-13.265 15.17-26.53 23.116-39.554 6.0198-9.8886 12.28-19.536 18.3-29.183 2.6487-3.859 5.2974-7.7179 7.9462-11.577 15.411-20.501 29.377-41.484 49.363-57.402 6.5014-5.0649 14.688-10.853 23.598-12.059 11.317-1.6883 19.023 4.3413 23.838 11.336 14.688 21.707 13.244 58.608 13.725 93.58zm-102.1-29.907c-2.6487 4.3413-5.0566 9.165-7.7054 13.748-3.3711 6.512-6.7422 13.024-9.8725 19.777-5.5382 11.095-10.595 22.671-15.411 34.248-8.9093 21.707-17.337 43.896-24.32 67.05h-0.24079c-2.8895 9.6474-6.0198 19.054-8.4277 29.183h-0.24079c-2.6487 10.371-5.2974 20.501-7.9462 30.872-3.3711 14.471-6.5014 28.942-8.9093 44.137-4.8159 30.872-10.595 70.908-4.3343 104.92 1.9263 10.371 5.0566 20.742 11.799 26.289 2.4079 2.1707 5.779 3.6178 9.1501 3.6178 6.5014 0 12.28-3.6178 16.615-6.7532 13.725-9.4062 24.079-22.913 33.47-36.178 13.003-18.571 24.561-38.348 34.433-58.849 0.24079 0 0.24079-0.24118 0.24079-0.48237 6.7422-13.024 13.003-26.772 18.782-40.76 4.3343-9.6474 8.187-20.018 12.28-30.148 3.3711-9.6474 6.983-19.054 10.113-28.701 7.2238-21.707 13.966-43.655 19.263-67.05 3.1303-12.059 5.779-24.601 8.187-37.384 1.204-7.7179 2.6487-15.195 3.6119-22.913 0.72238-4.8237 1.4448-9.8886 1.9263-15.195 2.8895-26.048 4.0935-59.814-4.0935-81.521-3.1303-8.6827-8.4277-18.089-19.504-18.089-9.3909 0-17.578 6.2708-23.357 11.336-15.892 13.506-27.45 29.907-38.768 47.996-2.4079 3.6178-4.8159 7.2356-6.7422 10.853z"/><path d="m257.6 69.526c-2.6512 3.8661-5.3024 7.7321-7.9537 11.598-23.861-20.297-49.409-41.077-80.501-56.058-5.3024-2.4163-10.846-4.591-16.389-6.2824-6.2665-2.1747-13.015-3.1412-19.764-2.8996-17.836 1.4498-20.005 19.33-16.389 37.211 5.5435 28.512 19.282 50.017 30.851 72.006-3.6153 0.96652-6.7486 2.1747-10.123 2.8996-8.9178-19.814-18.559-40.11-24.343-63.548-2.8922-11.598-5.3024-27.062-1.2051-38.419 4.0973-11.357 13.015-16.672 28.199-15.464 13.015 0.96652 23.861 5.0742 34.225 9.6652 30.851 13.531 57.422 31.328 83.693 48.967 0 0-0.30037 0.32572-0.30037 0.32572z"/><path d="m266.05 74.166c14.071 10.09 27.895 20.179 41.472 30.515-10.121 0.49218-20.242 0.73827-30.117 1.4765-6.4184-6.1523-12.837-12.305-19.502-17.965 2.7155-4.6757 5.1841-9.5975 8.1464-14.027z"/><path d="m358.3 104.4c-0.48123 5.3517-1.2031 10.217-1.9249 15.325-9.3839 0.72978-18.046 1.9461-26.949 3.1624-10.587 1.2163-20.693 3.1624-30.798 4.8652-22.618 4.3787-44.513 9.4871-65.928 14.839 4.8123-11.676 9.8651-23.353 15.399-34.543 9.6245-0.72978 19.008-1.7028 28.874-1.9461 9.3839-0.72978 19.49-0.97304 29.355-1.4596 17.084-0.24326 34.889-0.72978 51.972-0.24326z"/><path d="m367.55 105.37c15.138 0.24149 29.555 0.96594 43.732 2.1734 28.113 2.4149 55.025 5.5542 76.41 15.214 9.8516 4.5882 21.145 11.591 22.346 23.666 1.2014 12.074-6.0071 21.009-11.774 27.771-18.742 21.492-44.452 34.291-69.202 49.263-12.975 6.7616-25.951 13.765-39.166 20.043-12.735 6.2786-25.71 12.074-38.926 17.87 1.4417-7.2446 2.6431-14.731 3.8445-21.975 9.1308-2.6563 18.021-5.5542 26.671-8.6935 13.936-4.5882 27.633-9.9009 41.088-15.938 18.262-7.4861 35.562-16.904 51.901-28.012 7.9293-5.0712 15.378-11.35 21.625-18.594 5.2862-6.2786 12.975-17.628 6.0071-28.254-5.0459-7.4861-14.898-12.316-24.749-15.214-30.035-9.418-73.767-8.6935-110.05-6.0372 0.24028-3.8638-0.24028-8.935 0.24028-13.282z"/><path d="m249.13 108c7.4755 8.4265 6.9932 21.427-1.4469 28.891-3.8583 3.3706-7.9625 3.3706-14.228 5.2966-6.7521 1.926-25.561 6.9819-43.406 13.001-9.4047 3.1298-17.604 6.0189-18.086 6.2597-4.8229 1.6853-9.6458 3.3706-13.986 5.2966-22.185 8.1857-43.647 18.297-64.145 30.335-9.887 5.5374-19.05 12.279-27.491 19.742-4.3406 3.6113-7.9578 7.9449-11.093 12.519-4.0995 6.5004-5.5463 14.445-0.72344 20.705 7.7167 9.871 26.526 14.686 41.718 17.334 18.327 2.6483 36.895 4.0929 55.463 3.6113-5.3052 15.168-10.128 30.817-14.228 47.188-59.081 1.926-108.03-8.4265-129.01-45.503-8.1989-14.686-10.61-31.78-6.5109-48.151 7.7167-29.131 31.349-48.392 54.017-62.597 24.356-15.168 52.329-25.52 82.231-34.428 3.376-0.72227 6.5109-1.926 10.128-2.6483 12.781-3.3706 26.285-6.2597 40.754-8.908 21.221-3.8521 41.477-6.5004 60.045-7.9449z"/><path d="m329.09 123.07c7.7714 6.562 16.063 13.45 23.591 20.255-2.4286 12.881-5.3768 25.193-8.5339 37.345-14.571-18.228-30.114-35.727-46.143-52.739 10.2-1.7013 20.4-3.6456 31.086-4.8608z"/><path d="m352.74 143.2c13.802 11.879 28.088 25.455 42.616 40.727 10.17 10.667 19.371 21.091 27.846 31.273-13.56 6.0606-27.361 11.394-41.405 16-3.3899-5.0909-6.7798-9.9394-10.412-15.03-8.959-12.606-18.16-24.485-27.119-35.394-8.4747-11.394-6.0534-27.152 5.327-35.636 1.2107-0.9697 2.1792-1.4545 3.1478-1.9394z"/><path d="m148.39 125c9.8807 15.817 20.725 31.874 32.534 48.17 2.8919 4.0741 5.7838 7.9085 8.6758 11.743-3.1329 6.7102-6.5068 13.42-9.6397 19.891-3.6149-6.2309-7.4708-12.462-11.086-18.932-11.327-19.891-21.448-39.303-30.847-58.235-1.9279-6.2309-5.0609-17.015-2.8919-17.974 2.1689-0.9586 9.8807 10.065 13.255 15.338z"/><path d="m208.2 209.42c14.966 18.393 30.897 35.576 47.069 52.276-12.069 1.9361-24.621 3.6303-36.931 5.3244-6.5172-9.4387-12.793-18.877-19.069-28.558 2.4138-9.9227 5.7931-19.361 8.931-29.042z"/><path d="m422.48 214.4c0.72414 0.48149 21.966 28.167 31.379 43.093 7.9656 12.278 14.724 25.278 20.517 38.76 6.5173 14.685 10.862 30.334 12.552 46.464 3.3793 38.278-15.448 64.76-42 75.112-14.966 5.7779-34.035 5.7779-50.931 1.6852-30.897-7.7038-54.069-25.278-76.276-41.649 6.0345-14.926 11.586-30.334 16.414-46.464 20.276 13.963 39.828 28.649 66.138 37.315 12.069 3.8519 28.724 5.7779 34.035-5.5371 4.8276-10.111 2.6552-23.111-1.931-35.871-7.7242-21.667-22.207-54.89-50.931-96.779 11.104-10.352 25.828-16.13 41.035-16.13z"/><path d="m355.06 238.22c1.4446 4.8205 1.2038 9.8821-0.24077 14.703-0.7223 2.6513-2.1669 5.0615-3.6115 7.2308-21.91 9.4-39.726 16.39-52.487 21.21-8.1861 3.1333-13.483 5.0615-16.372 6.0256-12.761 4.3385-26.003 8.4359-39.245 12.533-19.984 5.5436-40.208 10.123-60.673 13.497 2.6484-15.185 5.5376-29.646 8.9084-44.108 9.1491-0.72308 18.057-1.6872 26.966-2.6513 0 0 17.817-2.1692 36.837-5.3026 41.412-6.9897 94.14-21.692 99.918-23.138z"/><path d="m280.85 287.63c6.4452 6.223 14.967 14.01 21.651 19.755-5.729 13.882-11.935 27.525-18.619 40.449-14.323-14.6-29.101-31.392-41.753-47.667 13.368-3.8295 26.07-8.2284 38.722-12.537z"/></g></g></g></svg>Edit with EXLcode</a>');

function getDesktopRepoPageType() {
    if (!$(".repository-content").length) {
        return "";
    }
    if ($('summary.btn.btn-sm.btn-primary').length) {
        return "main"
    }
    if ($('.file').length) {
        return "file"
    }
    if ($('.files').length) {
        return "files"
    }
    return "unknown"
}

function isDesktopRepoPage() {
    return getDesktopRepoPageType() != "" && !document.getElementById('exlcode-btn')
}

function exlcodeOpenUrl() {
    return "https://exlcode.com/ide/?repo=" + cleanRepoValue();
}

function cleanRepoValue() {
    var pathParts = window.location.pathname.substring(1).split('/');
    if (!pathParts || pathParts.length < 2) {
        return ""
    }
    return pathParts[0] + '/' + pathParts[1];
}

function loadDesktopRepoBtn() {
    desktopBtn.attr("href", exlcodeOpenUrl());
    desktopBtn.click(function (e) {
        trackEvent("clicked-edit-btn");
    });
    switch (getDesktopRepoPageType()) {
        case "":
            break;
        case "file":
            trackEvent('inject-show-on-file-page');
            desktopBtn.addClass("exlcode-edit-btn-file");
            desktopBtn.insertBefore(".BtnGroup.float-right");
            break;
        case "files":
            trackEvent('inject-show-on-files-page');
            desktopBtn.addClass("exlcode-edit-btn-files");
            desktopBtn.insertBefore(".BtnGroup.float-right");
            break;
        case "main":
            trackEvent('inject-show-on-main-page');
            desktopBtn.addClass("exlcode-edit-btn-main");
            desktopBtn.insertAfter(".new-pull-request-btn");
            break;
        case "unknown":
            trackEvent('inject-unknown-page-type');
            break;
    }
}